Para el manejo del consecutivo, lo que hago es adicionar el archivo a la tabla de documentos, y una vez tenga el ID con el cual adicione el mismo en un procedimiento almacenado selecciono el top 1 descendentemente con la condicion del tipo de comunicado type 1 CE o 0 CI, a este le hago un substring para obtener el valor despues del CE o CI, lo convierto a un int y le sumo 1, ya posterioremente le adiciono el CE o el CI dependiente de la regla anterior y paso el parametro al insert para que registre el parametro.